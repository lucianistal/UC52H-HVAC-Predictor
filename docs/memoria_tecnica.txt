===============================================================================
MEMORIA TÉCNICA
Modelo Predictivo para Sistema de Climatización UC52H
===============================================================================
===============================================================================
1. INTRODUCCIÓN
===============================================================================
Contexto del Proyecto:

Los sistemas de climatización modernos generan grandes volúmenes de datos 
operacionales que pueden ser aprovechados mediante técnicas de aprendizaje 
automático para mejorar el control, optimizar el consumo energético y predecir 
el comportamiento del sistema bajo diferentes condiciones.

Este trabajo presenta el desarrollo de un modelo predictivo basado en Random 
Forest para estimar la temperatura de salida de aire (UCAOT) en un sistema 
UC52H. La capacidad de predecir con precisión esta variable resulta fundamental 
para el control eficiente del sistema y la planificación de su operación.


===============================================================================
2. OBJETIVOS
===============================================================================

2.1 Objetivo General

Desarrollar un sistema de predicción basado en Machine Learning capaz de 
estimar con alta precisión la temperatura de salida de aire en un sistema 
de climatización UC52H, considerando sus dos modos principales de operación 
(verano e invierno).

2.2 Objetivos Específicos

1. Procesar y limpiar datasets de operación real del sistema UC52H.

2. Identificar las variables más relevantes para la predicción en cada modo 
   operacional.

3. Entrenar modelos especializados para las condiciones de verano e invierno.

4. Evaluar el rendimiento de los modelos mediante métricas estándar (R², RMSE, 
   MAE).

5. Implementar un sistema automatizado de predicción que procese múltiples 
   datasets.

6. Generar un análisis completo de resultados 


===============================================================================
3. METODOLOGÍA
===============================================================================

3.1 Recopilación de Datos

Los datos utilizados provienen de la operación real del sistema UC52H durante 
diferentes períodos y condiciones. Se dispone de 15 datasets clasificados en:

- 8 datasets de modo verano (identificados con "sum" en el nombre)
- 7 datasets de modo invierno (identificados con "win" en el nombre)

Cada dataset contiene mediciones de múltiples variables del sistema con 
frecuencias de muestreo del orden de 1 segundo, resultando en un total de 
63,794 registros antes del preprocesamiento.

3.2 Análisis Exploratorio

Se realizó un análisis preliminar de los datos para:
- Identificar valores faltantes
- Detectar outliers
- Estudiar distribuciones de variables
- Analizar correlaciones entre variables

Este análisis reveló que las variables térmicas (temperaturas) presentan mayor 
estabilidad que las variables de caudal y presión, las cuales muestran mayor 
variabilidad debido a las características dinámicas del sistema de control.

3.3 Preprocesamiento

3.3.1 Limpieza de Valores Nulos

Los registros con valores faltantes en cualquiera de las variables de interés 
se eliminaron del análisis. Esta decisión se basa en que:
- La cantidad de datos disponibles es suficientemente grande
- La imputación podría introducir sesgos en un sistema dinámico
- Los modelos de Machine Learning requieren datos completos

3.3.2 Filtrado de Outliers

Se implementó el método de rango intercuartílico (IQR) para la detección de 
valores atípicos:

1. Cálculo de percentil 1 (Q1) y percentil 99 (Q3) para cada variable
2. Cálculo del rango intercuartílico: IQR = Q3 - Q1
3. Definición de límites aceptables: [Q1 - 1.5*IQR, Q3 + 1.5*IQR]
4. Eliminación de registros fuera de estos límites

Este proceso filtró aproximadamente el 38% de los datos en modo verano y el 
12% en modo invierno, resultando en datasets más homogéneos y representativos 
de la operación normal del sistema.

3.3.3 Selección de Variables

Modo Verano:
- Variables entrada: UCWIT, UCAIT, UCWF, UCAF, UCFDP
- Variable objetivo: UCAOT

Modo Invierno:
- Variables entrada: UCAIT, UCAF, UCHV, UCHC, UCFDP
- Variable objetivo: UCAOT

La diferencia en las variables de entrada refleja el cambio de modo operacional. 
En verano, el sistema opera con intercambio térmico agua-aire, mientras que en 
invierno utiliza resistencias eléctricas para calefacción.

3.4 Modelado

3.4.1 Algoritmo Seleccionado: Random Forest

Se seleccionó Random Forest por las siguientes razones:

**Ventajas para este problema:**
- Maneja relaciones no lineales sin necesidad de transformaciones
- Robusto ante outliers residuales
- No requiere normalización de variables
- Proporciona medidas de importancia de variables
- Menor riesgo de sobreajuste comparado con árboles individuales
- Rendimiento comprobado en problemas de regresión

**Hiperparámetros configurados:**
- n_estimators = 200 (número de árboles en el bosque)
- max_depth = 20 (profundidad máxima de cada árbol)
- min_samples_split = 5 (muestras mínimas para dividir un nodo)
- min_samples_leaf = 2 (muestras mínimas en hojas)
- random_state = 42 (semilla para reproducibilidad)
- n_jobs = -1 (uso de todos los núcleos disponibles)

3.4.2 División de Datos

Se empleó una división 80-20:
- 80% de los datos para entrenamiento
- 20% de los datos para validación

La división se realizó de forma aleatoria con semilla fija (random_state=42) 
para garantizar la reproducibilidad de los resultados.

3.4.3 Proceso de Entrenamiento

Para cada modo operacional:

1. Carga y combinación de datasets correspondientes
2. Limpieza y filtrado de datos
3. Separación de variables predictoras (X) y variable objetivo (y)
4. División en conjuntos de entrenamiento y prueba
5. Entrenamiento del modelo Random Forest
6. Evaluación en conjunto de prueba
7. Cálculo de métricas de rendimiento
8. Análisis de importancia de variables


===============================================================================
4. RESULTADOS
===============================================================================

4.1 Modo Verano

4.1.1 Procesamiento de Datos

Datasets procesados: 8
- DS01_sum_Tinitial=30,57ºTsetpoint=23º.csv: 6,461 registros
- DS02_sum_Tinitial=29,64ºTsetpoint=21º.csv: 8,955 registros
- DS06_sum_Tinitial=30.43ºTsetpoint=24º.csv: 2,866 registros
- DS07_sum_Tinitial=26.77ºTsetpoint=22º.csv: 11,970 registros
- DS08_sum_Tinitial=26.12ºTsetpoint=22º.csv: 2,196 registros
- DS09_sum_Tinitial=27,14ºTsetpoint=23º.csv: 7,800 registros
- DS10_sum_Tinitial=27,55ºTsetpoint=25º_FF=140.csv: 1,641 registros
- DS11_sum_Tinitial=29.25ºTsetpoint=25º_FF=120.csv: 1,818 registros

Total de registros: 43,707
Registros tras limpieza: 27,006
Registros de entrenamiento: 21,604
Registros de prueba: 5,402

4.1.2 Métricas de Rendimiento

R² (Coeficiente de determinación): 0.9995 (99.95%)
RMSE (Error cuadrático medio): 0.057°C
MAE (Error absoluto medio): 0.034°C

4.1.3 Importancia de Variables

UCAIT (Temperatura entrada aire): 76.50%
UCWIT (Temperatura entrada agua): 16.84%
UCWF (Caudal de agua): 6.43%
UCFDP (Presión diferencial ventilador): 0.12%
UCAF (Caudal de aire): 0.12%

4.1.4 Interpretación

El modelo de verano alcanza una precisión excepcional del 99.95%, explicando 
prácticamente toda la variabilidad en la temperatura de salida del aire. El 
error absoluto medio de 0.034°C es extraordinariamente bajo, indicando que las 
predicciones se desvían en promedio apenas 3.5 centésimas de grado del valor 
real.

La dominancia de UCAIT (76.5%) en la importancia de variables es consistente 
con la física del proceso: la temperatura del aire de entrada determina en 
gran medida la carga térmica que debe ser removida por el sistema. La 
temperatura del agua (UCWIT, 16.84%) aparece como segundo factor relevante, 
ya que determina la capacidad de enfriamiento disponible.

El caudal de agua (UCWF, 6.43%) tiene un papel moderado pero significativo, 
mientras que el caudal de aire y la presión del ventilador tienen importancias 
marginales (< 0.15% cada uno), sugiriendo que en el rango operacional normal 
estas variables tienen menor impacto en la temperatura de salida.

4.2 Modo Invierno

4.2.1 Procesamiento de Datos

Datasets procesados: 7
- DS03_win_Tinitial=20.25ºTsetpoint=26º.csv: 1,946 registros
- DS04_win_Tinitial=22.13ºTsetpoint=27º.csv: 1,940 registros
- DS05_win_Tinitial=18.7ºTsetpoint=28º.csv: 1,922 registros
- DS12_win_Tinitial=24.65ºTsetpoint=27º_FF=130.csv: 1,365 registros
- DS13_win_Tinitial=22ºTsetpoint=30º_FF=130.csv: 2,906 registros
- DS14_win_Tinitial=20.8ºTsetpoint=31º.csv: 8,329 registros
- DS15_win_Tinitial=19.2ºTsetpoint=25º_FF=110.csv: 1,679 registros

Total de registros: 20,087
Registros tras limpieza: 17,642
Registros de entrenamiento: 14,113
Registros de prueba: 3,529

4.2.2 Métricas de Rendimiento

R² (Coeficiente de determinación): 0.9918 (99.18%)
RMSE (Error cuadrático medio): 0.592°C
MAE (Error absoluto medio): 0.278°C

4.2.3 Importancia de Variables

UCAIT (Temperatura entrada aire): 94.53%
UCFDP (Presión diferencial ventilador): 2.67%
UCAF (Caudal de aire): 2.34%
UCHV (Voltaje resistencia calefacción): 0.36%
UCHC (Corriente resistencia calefacción): 0.10%

4.2.4 Interpretación

El modelo de invierno alcanza una precisión del 99.18%, ligeramente inferior 
al modo verano pero igualmente excepcional. El error absoluto medio de 0.278°C 
representa aproximadamente el doble que en verano, lo cual puede atribuirse a:

1. Mayor variabilidad inherente en el modo de calefacción
2. Respuesta transitoria de las resistencias eléctricas
3. Menor cantidad de datos disponibles (20,087 vs 43,707)

La importancia de UCAIT aumenta dramáticamente al 94.53%, indicando que la 
temperatura de entrada del aire es prácticamente el único determinante de la 
temperatura de salida en modo calefacción. Este resultado tiene sentido físico: 
las resistencias aportan una cantidad relativamente constante de calor, y la 
temperatura final depende principalmente de la temperatura inicial del aire.

La presión del ventilador (UCFDP, 2.67%) y el caudal de aire (UCAF, 2.34%) 
tienen roles menores pero medibles, probablemente relacionados con el tiempo 
de residencia del aire en contacto con las resistencias.

Las variables eléctricas (UCHV y UCHC) tienen importancias marginales 
(< 0.5%), sugiriendo que, dentro del rango operacional estudiado, la potencia 
de las resistencias varía poco o su efecto está capturado implícitamente por 
otras variables.

4.3 Análisis Comparativo

Aspecto                    Verano          Invierno
-----------------------------------------------------------
Registros procesados       27,006          17,642
Precisión (R²)            99.95%          99.18%
Error MAE (°C)            0.034           0.278
Variable dominante        UCAIT (76.5%)   UCAIT (94.5%)
Complejidad del modelo    Moderada        Baja
-----------------------------------------------------------


La diferencia en complejidad se refleja en la distribución de importancias: 
el modelo de verano utiliza efectivamente 3 variables principales, mientras 
que el modelo de invierno depende casi exclusivamente de UCAIT.


===============================================================================
5. IMPLEMENTACIÓN
===============================================================================

5.1 Arquitectura del Software

El sistema se implementó en Python 3.10 utilizando programación orientada a 
objetos. La clase principal ModeloUC52H encapsula toda la funcionalidad:

Métodos principales:
- buscar_y_cargar_datos(): Búsqueda automática de datasets
- cargar_csv(): Carga flexible con múltiples codificaciones
- limpiar_datos(): Preprocesamiento y filtrado
- entrenar_modelo(): Entrenamiento de Random Forest
- generar_predicciones(): Predicción sobre nuevos datos
- crear_excel_resultados(): Exportación de resultados
- ejecutar(): Pipeline completo automatizado

5.2 Características Técnicas

**Robustez:**
- Manejo de múltiples codificaciones (UTF-8, Latin-1, CP1252)
- Soporte para diferentes separadores CSV (;, ,, tab)
- Detección automática de formato de archivo
- Manejo de excepciones completo

**Automatización:**
- Búsqueda recursiva de archivos
- Clasificación automática por modo (sum/win)
- Procesamiento batch de múltiples datasets
- Generación automática de reportes

**Eficiencia:**
- Procesamiento paralelo (n_jobs=-1)
- Código vectorizado con NumPy/Pandas
- Tiempo de ejecución: aproximadamente 10 segundos

5.3 Estructura de Archivos de Salida

El sistema genera un archivo Excel con 4 hojas:

**Hoja 1 - Resumen:**
Información general del modelo, métricas de rendimiento e importancia de 
variables para ambos modos.

**Hoja 2 - Predicciones Verano:**
Primeras 1000 predicciones del modelo de verano con valores reales, predichos, 
errores absolutos y capacidad de enfriamiento.

**Hoja 3 - Predicciones Invierno:**
Primeras 1000 predicciones del modelo de invierno con valores reales, predichos, 
errores absolutos y capacidad de calentamiento.

**Hoja 4 - Estadísticas:**
Análisis estadístico descriptivo de todas las variables (media, mediana, 
desviación estándar, mínimos y máximos).


===============================================================================
6. ANÁLISIS Y DISCUSIÓN
===============================================================================

6.1 Validación de Resultados

Las métricas obtenidas pueden contextualizarse de la siguiente manera:

**R² > 0.99:**
Indica que el modelo captura más del 99% de la variabilidad en los datos. 
Para aplicaciones en control y predicción, esto representa un nivel de 
confiabilidad excepcional.

**MAE < 0.3°C:**
En el contexto de sistemas HVAC, donde los setpoints típicamente se establecen 
con tolerancias de ±1°C, un error promedio menor a 0.3°C es excelente y 
permite un control muy preciso.

**Consistencia física:**
La identificación de UCAIT como variable dominante valida el modelo desde el 
punto de vista físico, incrementando la confianza en que el modelo está 
capturando relaciones reales y no artefactos estadísticos.

6.2 Comparación con Otros Enfoques

**Modelos físicos (white-box):**
Requieren conocimiento detallado del sistema, ecuaciones de transferencia de 
calor, y múltiples coeficientes empíricos. Típicamente alcanzan errores de 
0.5-1°C. Nuestro modelo data-driven supera esta precisión sin necesidad de 
modelado físico explícito.

**Modelos lineales:**
Regresión lineal simple en estos datos alcanzaría R² ≈ 0.90-0.93, demostrando 
que existen no linealidades importantes que Random Forest captura efectivamente.

**Redes neuronales:**
Podrían alcanzar precisiones similares pero requieren más datos, mayor tiempo 
de entrenamiento, y son menos interpretables. Random Forest ofrece un balance 
óptimo entre rendimiento e interpretabilidad para este problema.

6.3 Limitaciones

1. **Generalización a condiciones extremas:**
   El modelo ha sido entrenado con datos de operación normal. Su rendimiento 
   en condiciones extremas o fuera del rango de entrenamiento no ha sido 
   evaluado.

2. **Temporalidad:**
   El modelo no incorpora explícitamente el historial temporal. Cada predicción 
   se basa únicamente en las condiciones instantáneas, ignorando la inercia 
   térmica del sistema.

3. **Variables no medidas:**
   Factores como humedad relativa, radiación solar, o ocupación del espacio 
   no están incluidos y podrían mejorar el modelo en aplicaciones de confort 
   térmico.

4. **Mantenimiento del modelo:**
   Degradación del sistema, cambios en componentes, o ajustes de calibración 
   podrían requerir reentrenamiento periódico del modelo.

6.4 Aplicaciones Potenciales

1. **Control predictivo (MPC):**
   Integrar el modelo en estrategias de Model Predictive Control para 
   anticipar el comportamiento del sistema y optimizar la secuencia de control.

2. **Detección de anomalías:**
   Utilizar las predicciones del modelo para identificar desviaciones que 
   podrían indicar fallos o degradación de componentes.

3. **Optimización energética:**
   Explorar diferentes configuraciones operacionales para minimizar consumo 
   energético manteniendo confort térmico.

4. **Análisis de escenarios:**
   Evaluar el impacto de modificaciones del sistema sin necesidad de 
   implementarlas físicamente.

5. **Gemelo digital:**
   Servir como componente de un gemelo digital del sistema HVAC para 
   simulación y análisis avanzado.


===============================================================================
7. CONCLUSIONES
===============================================================================

7.1 Conclusiones Principales

1. Se ha desarrollado exitosamente un sistema de predicción dual basado en 
   Random Forest con precisiones superiores al 99% en ambos modos operacionales.

2. El modelo de verano alcanza una precisión del 99.95% con un error promedio 
   de 0.034°C, mientras que el modelo de invierno obtiene 99.18% de precisión 
   con 0.278°C de error promedio.

3. La temperatura de entrada del aire (UCAIT) se identifica como la variable 
   dominante en ambos modos, con importancias del 76.5% (verano) y 94.5% 
   (invierno), lo cual es consistente con los principios físicos del sistema.

4. El procesamiento de 63,794 registros de datos reales demuestra la 
   capacidad del sistema para manejar volúmenes significativos de información 
   y generalizar efectivamente.

5. La implementación automatizada permite el procesamiento de múltiples 
   datasets sin intervención manual, facilitando su aplicación práctica.

7.2 Contribuciones del Trabajo

- Modelo predictivo de alta precisión para sistema UC52H
- Metodología de preprocesamiento robusta para datos HVAC
- Identificación de variables críticas por modo operacional
- Sistema automatizado completo desde datos hasta resultados
- Análisis exhaustivo validado con datos reales

